# 下一代分布式体系架构的理念与演进  菜鸟网络

> 阿里公司的人员来讲
> 黄浩先生主讲

##   菜鸟HR讲话

在阿里用花名，是阿里的一种文化。 菜鸟公司精品课堂首秀。

### 为什么做这件事？

毕业生才从一种白纸走向社会人，趁着感受企业技术的演化。和大家之间提前联系，更早融入社会。


---- 

##  正片开始

## 二十年分布式系统的发展和优劣势对比

### 分布式系统的三大问题

- 分布式节点数据通信问题
    - 网络质量，IO吞吐，通信状态
- 多节点协同计算效率问题
    - 节点故障容错，计算协同
- CAP平衡
    - 一致性，可用性，分区容错



### 常见的分布式架构

#### 负载分片模式

- 架构结构和特点
    - 节点构成一致，节点间相对隔离无通讯


基于共享内容的负载分发：数据和计算的分离

#### 主备模式

在数据库中很常用

##### 问题

主备都出问题该怎么办？主的是虚拟的，一群节点都可以当主节点，通过选举算法来决定哪个节点是主节点。每个人都有可能当主节点。

#### 对等模式

多节点通信复杂，通过一个管理节点充当通讯员的职责，保证节点之间的通信无误。

### 分布式技术架构的发展历程

ebay Base理论：影响了整个中国互联网，

- 基本可用
- 最终的一致性
- 扩展性和弹性

![]()

![]()

目前这个阶段，互联网技术太碎片化了，SOA体系太重了，RPC太碎了。提出了微服务的理念。

今天的云计算是一个混合云的架构；

IOT物联网的即将普及，目前的架构都是云端架构基于x86服务器体系，并没有推到每一个有计算能力的节点，未来在端上的计算能力会越来越强，肯定会和云上的计算合并

### 常见的分布式架构策略

- ebay BASE理论指导下的一系列分布式计算策略：最终一致性，降解了分布式系统的难题
    - 在分布式系统中，某个瞬间数据可能不一致。但在可接受返回内保持最终一致性即可
- 互联网公司常见的架构策略
    - 基于请求http/RPC流量的无状态负载分发+中心事数据层共享节点
    - 应用层间网装

### 基于微服务的架构

二种通信模式:

- 百度，微博：网关型的通信，为了保证双方无关系，提供一个网关去调度伸缩。但是代理节点容易出现问题。架构的松耦合，服务的受用者和提供方的分离。
- 阿里巴巴：软负载，这个代理个体不存在，打个比喻：老师打印一个名单，然后根据这个名单去工作。应用之间通信的绑定，带来了架构绑定。 菜鸟的系统和阿里的系统要绑定在一起，无法隔离，软地址的IP负载就无法使用


## 目前主流分布式架构体系的构成

### 当前流行的应用框架模式

![]()

### 现在流行的混合云架构

核心点：读写分离

阿里云走读，本地走买

**12306混合云架构**
![]()

**微博混合云架构**
![]()


微博宕机的原因是因为大量的评论和转载，写是其瓶颈。


### 阿里巴巴单元化体系架构

**流量分离+中央管理对等架构**

sharenode 和 masternode ，中心机房还是问题所在。如何做到下一代的单元化，异地多活

最上层是负载均衡策略，根据用户分流到不同的数据中心。

当某个中心的流量扛不住时，会进行流量引流
![]()

### 菜鸟混合云架构--双机房

一定需要docker屏蔽底层的差异

![]()




## 菜鸟以及阿里巴巴面临的问题和挑战

### 当前云计算的问题

业界吹牛的多。

- 单域节点问题：真个中国被划分多个区域
- 开源技术的问题：缺少一定的标准

### 微服务的另外一面

系统的依赖图

- 实际业务场景的跨服务述求
- 大量的远程的调用
    - 一个for循环调用远程服务，会产生很大的流量
    - 海啸效应：在整个链路上的for循环远程调用很恐怖，会被不断的放大。40万次qps for循环10次会变成400万次。需要优化链路上东西

### 互联网架构模式的适应性

- 目前互联网架构最重要的核心理念
    - 基于用户流量分片的模式
    - 系统能力和述求的不一致性
    - 读写隔离
- 存在适应性问题    

### 系统架构什么才最重要

1. 清晰的结构关系
2. 结构调整的前瞻性
3. 面向场景的稳定性

## 菜鸟下一代架构的理念和实践

- 应用的开发与部署环境和位置无关性
- 全球化网络架构，非站点依赖
- 对等架构模式：优点任何一个节点出现了问题，都无关大局
- 容器化技术和网格计算能力：docker的出现推进了云计算的发展。
- 更大范围分布式数据可信存储以及一致性保障：区块链的技术如何应用

### 基于模块化的微服务架构

![]()

### 菜鸟异地多活模式

![]()

电子面单，如何这个系统出问题，就是一个社会性时间。针对这个问题做了异地多活。





### 如何学习分布式技术

二样东西

- 最常用东西的基本应用
- 跳开现实的常见，回归原理，学会举例子。背后的理念很重要，很多都来源于生活。


- 写注释，阅读能力和理解能力 看开源代码，看懂看透  画2个月的时间去看kubernetes代码，看透
- 理念和思想，面向对象能力。设计模式，用现实生活的常见去解释它。

