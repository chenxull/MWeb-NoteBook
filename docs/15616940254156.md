# Making Containers Easier with HPC Container Maker


## I  NTRODUCTION 
摘要—容器使科学家和工程师能够轻松使用可移植和可再现的软件环境。但是，如果容器注册表中还没有所需的应用程序，那么对于习惯裸机软件环境的用户来说，从头开始生成自定义容器映像可能是一项挑战。高性能容器制造商(HPCCM)是一个解决这些挑战的开源项目。高性能计算控制模块提供了一种高级的、可配置的Python配方格式，用于根据最佳实践将高性能计算组件部署到容器映像中。HPCCM配方比原生容器规格格式更具可移植性和功能性，更易于创建，并产生更小、构造更好的容器图像。


容器通过将应用程序封装到隔离的虚拟环境中，简化了高性能计算数据中心中的软件部署。通过包含所有应用程序依赖项，如二进制文件和库，应用程序容器可以在任何数据中心环境中无缝运行。因此，除了容器运行时本身之外，容器可以很容易地共享，而不需要考虑部署系统上的底层软件环境。容器甚至可以运行与主机完全不同的Linux发行版。

容器还提供了一个可再现的软件环境。随着整个用户空间软件环境的封装，消除了系统间结果差异的重要来源。容器映像的校验和可以进行比较，以验证是否使用了相同的容器映像。


与虚拟机不同，虚拟机提供类似的软件堆栈隔离好处，相对于裸机[1]，[2]，容器的性能影响可以忽略不计。由于容器共享主机操作系统内核，与虚拟机相比，启动时间较短。码头工人[3]在推广集装箱方面发挥了重要作用，最近出现了针对高性能计算的集装箱运行时间，如奇异[4)、移位器[5]和查理·路德·[6]。

集装箱注册中心，如码头中心、奇点中心和英伟达图形处理器云主机预构建的集装箱映像，在提供优化性能的同时，极大地提高了应用程序部署的便利性。但是，如果容器注册表中没有所需的应用程序，从头开始构建高性能计算容器映像可能会令人生畏。传统上由高性能计算数据中心提供的部分软件环境必须重新部署到容器中。本文描述了高性能计算容器制造商(高性能计算容器制造商)，这是一个开源项目，旨在解决创建[7]高性能计算应用容器的挑战。

### A. Related Work
环境模块[8]通常用于高性能计算系统，以管理软件开发和运行时环境。无论是从源构建应用程序还是使用预编译的二进制文件，用户都加载适合于该应用程序的环境模块集，例如编译器、MPI库、数学库和其他支持软件组件。系统管理员已经在系统上预先安装了软件包。典型的高性能计算系统可能有数百个相互依赖的环境模块。例如，可以为编译器版本和MPI库版本的每个组合安装数学库的多个实例。环境模块设置也是专门针对每个高性能计算系统的，因此应用程序运行脚本可能不可移植，在某些情况下，应用程序二进制文件也可能不可移植。

EasyBuild [9]和Spack [10]是管理高性能计算软件组件的常用框架。EasyBuild和Spack自动执行构建应用程序所需的所有步骤，包括下载和安装任何所需的软件组件，如编译器、MPI库、数学库或其他支持软件组件。软件组件版本和构建选项在配方中有精确的规定，因此可以在任何系统上轻松生成“相同”的二进制文件。但是，由于二进制文件的运行时依赖性，二进制文件本身可能无法移植到其他系统。应用程序通常在每个系统上重新生成。

容器图像可以用EasyBuild和Spack生成。然而，这些工具是为裸机用例设计的，因此与“本地”集装箱作业流程相比，集装箱化过程和结果并不理想。例如，EasyBuild和Spack将整个复杂的应用程序构建过程打包成一个步骤。虽然这对于裸机用例来说是理想的，但对于容器来说却不是一个理想的选择。应用程序构建可能需要几个小时才能完成，如果在容器构建过程中有任何错误，整个过程必须从头开始。如果构建过程被分成更简单、更细粒度的步骤，成功的步骤可以使用容器层[11缓存，从而加快整体速度
建造时间。此外，由于不能使用多阶段构建等容器最佳实践，因此生成的容器映像大小可能比需要的大得多。不幸的是，如果没有基本的重新架构，这些裸机工具无法利用这些容器最佳实践。

### B. Container Images

为了构建容器图像，容器框架依赖于定义相应容器图像内容的输入规范。该规范包含构建容器映像时要执行的一组精确步骤。对于给定的组件，这些步骤可能包括下载源代码、配置和构建、安装以及最终清理。输入规格是码头工人和许多其他容器运行时间的码头工人[12和奇点的奇点配方[13。
## II. M AKING C ONTAINERS E ASIER

高性能计算容器制造商是一个开源项目，它解决了创建高性能计算应用程序容器的挑战。高性能计算组件将部署核心高性能计算组件的最佳实践与容器最佳实践封装到模块化构建模块中，以减少容器开发工作并最小化映像大小。通过将容器映像中应包含的内容与如何配置、构建和安装组件的规格和语法细节分开，高性能计算组件管理使创建高性能计算应用程序容器变得更加容易。这种分离还使得高性能计算组件部署的最佳实践能够随着时间透明地发展。

对于HPCCM，容器规格或配方是一个Python脚本。这提供了几个优点。它从文档或奇异配方的特定语法细节中提取配方。给定一个Python配方文件和所需的输出格式，HPCCM生成相应的文档文件或奇点配方文件。生成的规格可以在相应的容器映像构建过程中正常使用。

基于Python的配方还允许使用Python编程语言的全部功能。例如，一个配方可能验证输入，分支取决于Linux
分发基础映像，根据选定的数字精度修改复杂的构建过程，或者搜索要下载的特定组件的最新可用版本。

最重要的是，高级配方规范将容器映像应该包含的内容与容器框架规范的低级语法细节分开。转换高级配方规格的过程还允许无缝应用容器最佳实践，例如有效的Docker映像分层和多阶段构建，并提取由于基本容器映像的Linux分布而产生的任何差异。构建每个软件组件的最佳实践也可以无缝使用，并且可以透明地更新，而不会影响Python配方规范的内容。