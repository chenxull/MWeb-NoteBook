# Jobservice 文件夹
jobservice 是 harbor中用来处理 job 的组件。在 1.75 版本中job 分为三种类型，分别为：`GC`,`Replication`，`Scan`。

因为 jobservice 在后端中作为守护进程为其他组件提供服务，在和其他组件进行通信时为确保通信安全，其他组件在访问` jobservice`的 API 时，访问请求的` header`中必须要有`Authorization`字段，样例如下：

```
Authorization : Harbor-Secret <secret>
```
这里的` secret`由环境变量`CORE_SECRET`提供

**样例**
`POST /api/v1/jobs`
> submit job

- request body
- 
```
{
    "job": {
        "name": "demo",
        "parameters": {
            "p1": "just a demo"
        },
        "status_hook": "https://my-hook.com",
        "metadata": {
            "kind": "Generic", // or "Scheduled" or "Periodic"
            "schedule_delay": 90, // seconds, only required when kind is "Scheduled"
            "cron_spec": "* 5 * * * *", // only required when kind is "Periodic"
            "unique": false
        }
    }
}
```

- Response
    - 202 Accepted

```
{
    "job": {
        "id": "uuid-job",
        "status": "pending",
        "name": "DEMO",
        "kind": "Generic",
        "unique": false,
        "ref_link": "/api/v1/jobs/uuid-job",
        "enqueue_time": "2018-10-10 12:00:00",
        "update_time": "2018-10-10 13:00:00",
        "multiple_executions": false // To indicate if the job has sub executions
    }
}
```


401/500 Error

```
{
    "code": 500,
    "err": "short error message",
    "description": "detailed error message"
}
```

`GET /api/v1/jobs/{job_id}`
>Get job stats

Response
200 OK
```
{
    "job": {
        "id": "uuid-job",
        "status": "pending",
        "name": "DEMO",
        "kind": "Periodic",
        "unique": false,
        "ref_link": "/api/v1/jobs/uuid-job",
        "enqueue_time": 1539164886,
        "update_time": 1539164886,
        "run_at": 1539164986,
        "cron_spec": "* 5 * * * * ",
        "check_in": "check in message", // if check in message
        "check_in_at": 1539164889, // if check in message
        "die_at": 0,
        "hook_status": "http://status-check.com",
        "executions": ["uuid-sub-job"], // the ids of sub executions of the job
        "multiple_executions": true
    }
}
```

401/500 Error

```
{
    "code": 500,
    "err": "short error message",
    "description": "detailed error message"
}
```

`POST /api/v1/jobs/{job_id}`
>Stop/Cancel/Retry job

Request body

```
{
    "action": "stop" //or "cancel" or "retry"
}

```
Response
204 No content
401/404/500/501 Error

```
{
    "code": 500,
    "err": "short error message",
    "description": "detailed error message"
}
```

`GET /api/v1/jobs/{job_id}/log`
>Retrieve job log
Response

200 OK
Log text bytes

401/400/404/500 Error

```
{
    "code": 500,
    "err": "short error message",
    "description": "detailed error message"
}

```

`GET /api/v1/stats`
>Check job service healthy status

Response

200 OK

```
[{
    "worker_pool_id": "pool1",
    "started_at": 1539164886,
    "heartbeat_at": 1539164986,
    "job_names": ["DEMO"],
    "concurrency": 10,
    "status": "healthy"
}]
```

401/500 Error

```
{
    "code": 500,
    "err": "short error message",
    "description": "detailed error message"
}
```

## main.go
获取配置信息，创建`root context`，给` root context`配置日志记录器，创建`job context`，最后启动服务接受请求。


## logger

