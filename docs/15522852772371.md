# Singularity

### 为什么不用 Docker？
Docker绝对是目前最热的容器技术，但是它却不特别适合 HPC 环境。有几个重要的原因：

1. 调度管理器的资源限制无法施加到容器中
2. 多用户（非 root 用户）使用时的权限问题
3. Docker 包含了不必要的资源开销

集群中的资源使用通常需要由调度管理器来进行分配，例如Slurm/PBS等系统负责资源分配。调度管理器根据用户需求为每个作业分配一定的资源，实质上是利用cgroups针对每个作业进行配置实现的。而Docker镜像的启动实际上是由Docker Daemon去执行的，如此一来资源限制自然会失效。并且Docker Daemon是由 root 用户启动的，无论是为普通用户设置sudoer还是将普通用户添加到 docker 用户组中都不是一个安全的方式。

### Singularity 的优势
Singularity拥有容器技术所包含的大多数优势，例如启动迅速、资源开销小、轻松的迁移和扩展等等。除此之外，相较于Docker这样的容器技术，它还有一些独特的优势：
- 更加轻松的环境打包迁徙：Singularity所依赖的东西都在镜像文件中，不需要再单独打包 / 导入，直接拷贝走镜像即可。没有复杂的缓存机制，并且该镜像已经过压缩，只需占用非常少的磁盘空间。
- 和现有系统无缝整合：系统用户权限、网络等均直接继承宿主机配置，并且无需进入某个镜像后再执行命令，可以直接在外部调用镜像内的指令，就像执行一个本地安装的指令一样。
- 无需运行 daemon 进程：Singularity提供的完全是一个运行时的环境，在不使用时不需要单独的进程，不占用任何资源。不由 daemon 进程代为执行指令，资源限制和权限问题也得以解决。