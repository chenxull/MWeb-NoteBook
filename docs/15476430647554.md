# 类型系统和泛型的本质

在编程世界，需要处理好二件事：

- 编程语言语言中的类型问题
- 对真实世界中业务代码的抽象，重用和拼装

## 类型系统

在计算机科学中，类型系统用于定义如何将编程语言中的数值和表达式归类为许多不同的类型，以及如何操作这些类型。还有这些类型之间是如何相互作用的。类型可以确认一个值或者一组值具有特定的意义和目的。

一般来说，编程语言会有二种类型：
- 内建类型如int,float,char等
- 抽象类型如struct,class,function等
抽象类型在程序运行中，可能不表示为值。类型系统在各种语言之间有着很大的差别。

编译器可能使用值的静态类型以最优化所需的存储区，并选取对数值运算时的最佳算法。例如，在许多 C 编译器中，“浮点数”数据类型是以 32 比特表示、与 IEEE 754 规格一致的单精度浮点数。因此，在数值运算上，C 应用了浮点数规范（浮点数加法、乘法等）。

**类型的约束程度以及评估方法，影响了语言的类型**。更进一步，编程语言可能就类型多态性部分，对每一个类型都对应了一个针对于这个类型的算法运算。类型理论研究类型系统，尽管实际的编程语言类型系统，起源于计算机架构的实际问题、编译器实现，以及语言设计。

程序语言的类型系统主要提供了如下功能：
- 程序语言的安全性：使用类型可以让编译器侦测一些代码的错误。例如：可以识别出一个错误无效的表达式。如：“Hello, World” + 3这样的不同数据类型间操作的问题。强类型语言提供更多的安全性，但是并不能保证绝对的安全。
- 利于编译器的优化：静态类型语言的类型声明，可以让编译器明确地知道程序员的意图。
- 代码的可读性：有类型的编程语言，可以让代码更易读和更易维护。代码的语义也更加清晰，代码模块的接口也更丰富和清楚
- 抽象化：允许程序设计者对程序以较高层次的方式思考，而不是烦人的低层次实现。例如，我们使用整型或是浮点型来取代底层的字节实现，我们可以将字符串设计成一个值，而不是底层字节的数组。从高层上来说，类型可以用来定义不同模块间的交互协议，比如函数的入参类型和返回类型，从而可以让接口更有语义，而且不同的模块数据交换更为直观和易懂。

有类语言，一类是静态类型语言如C，C++,java,一种是动态类型语言如Python,PHP,javascript.

动态类型语言的代码
```
x = 5;
x = "hello";
```
在动态语言中，会以**类型标记**维持程序所有数值的标记，并在运算任何数值之前检查标记。所以一个变量的类型是由运行时的解释器来动态标记的，这样就可以动态地和底层的计算机指令或内存分布对应起来。

### 不同语言

我们需要清楚的知道，无论哪种程序语言，都避免不了一个特定的类型系统。哪怕是可随意改变变量类型的动态类型的语言，我们在读代码的过程中需要知道某个变量在运行时的类型。

所以每个语言都需要一个类型检查系统。
- 静态类型检查是在编译器进行语义分析时进行的。如果一个语言强制实行类型规则（即通常只允许以不丢失信息为前提的自动类型转换），那么称此处理为强类型，反之称为弱类型。
- 动态类型检查系统更多的是在运行时期做动态类型标记和相关检查。所以，动态类型的语言必然要给出一堆诸如：is_array(), is_int(), is_string() 或是 typeof() 这样的运行时类型检查函数。

## 泛型的本质

- 类型是对内存的一种抽象，不同的类型，会有不同的内存布局和内存分配的测量
- 不同的类型，有不同的操作。所有对于特定的类型，也会有特定的一组操作。

要做到泛型，需要做到下面的事情：
- 标准化掉类型的内存分配
- 标准化掉类型的操作
- 标准化掉数据容器的操作
- 标准化掉类型上特有的操作

下面以C++为例，通过一些复杂的技术来达到泛型编程的目标：
- 通过类中的构造、析构、拷贝构造，重载赋值操作符，标准化（隐藏）了类型的内存分配、释放和复制的操作。 
- 通过重载操作符，可以标准化类型的比较等操作。
- 通过 iostream，标准化了类型的输入输出控制。
- 通过模板技术（包括模板的特化），来为不同的类型生成类型专属的代码。
- 通过迭代器来标准化数据容器的遍历操作。
- 通过面向对象的接口依赖（虚函数技术），来标准化了特定类型在特定算法上的操作。
- 通过函数式（函数对象），来标准化对于不同类型的特定操作。

本质就是**屏蔽掉数据和操作数据的细节，让算法更为通用，让编程者更多地关注算法的结构，而不是在算法中处理不同的数据类型**