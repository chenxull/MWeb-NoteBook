# Security Analysis of Container Images Using Cloud Analytics Framework（2018）
## 摘要

容器技术已成为当今主要IT服务不可或缺的一部分。虽然它带来了几个好处，但它也为操作和维护安全的容器环境带来了新的挑战。

其中一个挑战是检测和解决容器漏洞和违规行为的能力。设计一个有效的解决方案以实现此功能必须基于对从实际容器镜像和实例中观察到的特征的准确理解。为了实现这一目标，我们建立了一个通用的数据处理框架，应用了最先进的原则。它是一个将数据收集过程与分析分离的系统，以便用户可以更专注于构建新的分析逻辑，而不是用于监视代理的工具。我们将其应用于Docker Hub映像存储库中的容器映像分析，以了解其安全状态。在这项工作中，我们通过分析公共图像语料库提出了各种有趣的发现和新的见解。我们了解到，超过92％的镜像包含违规行为和/或易受攻击的软件包。

自己构建镜像分析工具来分析docker hub上的进行，然后得出检测结果并分析这些数据，最后总结需要从镜像的哪些角度去解决问题。

## 介绍
解决容器安全的第一步就是要明白现在面临的安全挑战是什么，只有清晰的认识到这个问题，才有可能基础合理的解决方案。这将使用户和管理员掌握以下有关容器安全状况的问题的知识：典型容器平均有多少包软件漏洞（如果有），哪些是最常见的漏洞？公共容器图像如何符合众所周知的最佳实践规则以及最常被违反的规则是什么？在我们看到之前检测到的容器图像漏洞被消除之前需要多长时间？如果使用容器，它对我的​​系统的安全性有什么影响？

使用[Agentless-system-crawler](https://github.com/cloudviz/agentless-system-crawler)这一工具来爬取docker Hub中的镜像，提取有关系统信息，文件元数据，以安装的包，配置文件的内容以及一些其他的信息。让后将这些数据传入到我们的数据处理管道中，这个过程中会使用几个独立的分析组件并行处理，每一个组件会确定镜像安全的不同层面，比如说软件漏洞，是否符合行业最佳规范。

## 数据处理架构

我的工作可以在其5个功能组件上在增加或者优化一些功能组件，以符合高性能计算的特殊需求。

![](https://ws3.sinaimg.cn/large/006tNbRwgy1fwrrsnkhoij30x80eg77k.jpg)


### ING
 Image Name Getter组件负责从Docker Hub收集容器映像名称。 它使用REST调用以检索包含图像列表的网页，并解析出名称和标签。 ING能够以两种不同方式收集：步行模式和排序模式收集图像名称列表。
 
步行模式：在此模式下，ING首先通过访问“探索”页面编辑官方图像列表。 它为我们提供了流行的官方图像列表，如ngnix，httpd，redis和ubuntu。 大约有100个这样的官方图像。 然后，ING将这些作为关键字放入Docker Hub搜索界面。 从该搜索的结果中提取最终的图像和标签列表。 ING以循环方式访问每个类别的网页，以编制从最受欢迎到最不受欢迎的图像列表。

排序模式：在此模式下，用户可以通过REST接口指定其中一个排序条件。 支持的条件是“全部”，“start”和“下载”。 在本研究中，我们使用了“下载”条件，该条件通过拉动计数对图像进行排序。 Docker Hub不提供精确的拉动计数，但不提供“10M +”，“5M +”，“1M +”，“500K +”，“100K +”，“50K +”和“10K +”等类别。
 
 
### ICL (Image Crawler)
 
 ICL组件使用Agentless- system-crawler爬虫工具（或简称爬虫）执行容器映像的扫描。启动时，ICL进入空闲模式并等待命令扫描开始的REST调用。用户可以通过REST接口发出自动爬网操作或单个映像爬网。在自动爬网模式下，ICL轮询后端存储以检查ING组件是否插入了新的映像名称和标记。如果检测到，ICL会执行图像的泊坞窗拉动，然后启动爬网操作。 ICL可以配置为给定图像名称提取具有不同标签的所有图像，或者可以配置为仅拉出具有最新标签的一个图像。已爬网的输出存储在后端存储中，供其他组件使用。

爬虫可以从容器图像中提取各种各样的状态。在丰富的支持状态“功能”中，我们在平台中使用了文件，包，配置和操作系统功能。 “文件”功能为我们提供了图像中所有文件和相关元数据的列表。 'packages'功能是图像中已安装软件包的列表。 “配置”功能是图像中几个关键配置文件的内容。我们使用它们来确定是否根据策略正确设置了配置。最后，“OS”功能包含发行版名称和操作系统版本等信息。
 
 
 
### CRC (Compliance Rule Checker)
CRC组件的作用是验证镜像是否符合一组最佳实践“规则”。最佳实践或合规性规则是一组已知可加强系统安全性的规则。我们编写了来自多个来源的合规性规则。很大程度上，它们分为5类 - SSH，密码，权限，FTP和“其他”。 “权限”类别指定了应为关键系统文件设置的所需安全权限。为了被认为是合规的，文件许可必须与指定的值相等或更严格。

CRC定期轮询后端存储，以检查ICL是否可以使用新爬网的数据。如果是，CRC将根据已爬网数据评估合规性规则。作为分析的结果，CRC按规则生成json结果并将其发送到后端存储。每个json文档指示规则ID，检查时间以及图像是否符合相应规则。

###  VPC (Vulnerable Package Checker) （在这一点上可以做深入的研究）

 VPC组件检查图像是否存在包含已知漏洞的软件包。 为了检测容器映像的易受攻击的包，VPC将爬行器收集并存储到后端存储中的包列表以及几个Linux发行版的已发布安全通知列表作为输入。 收集安全通知是SNP组件的责任。 VPC只是使用该信息来执行包版本比较。 对于映像中已安装包列表中的每个包，VPC会在安全通知中搜索具有匹配包名称的任何描述。 然后，它比较版本号以确定安装的版本是否易受攻击。 如果没有，VPC会创建一个包含易受攻击的包信息的json条目，并将其存储在后端存储中。 
 
### SNP (Security Notice Parser)
 
SNP是一个自动运行的组件，可定期扫描公开的安全公告，并将软件包漏洞信息提取并存储到后端存储中的一个索引中。 安全公告包含漏洞，CVE（常见漏洞暴露）ID，软件包名称和固件版本的说明。 它们通常以邮件列表的形式提供给公众。 这些是SNP监测的来源：

- DSA (Debian Security Announce)
- USN (Ubuntu Security Notices)
- CeSA (CentOS Security Alerts)
 
 
 
### 分析
对爬取到的数据进行各种分析，然后得出各种结论，在这里不赘述了。
 
 
## 相关工作

这一章节有很多有用信息，提供了很多和可供参考的工具，在之后的研究中，可能会用到
。

作为未来的工作，我们计划扩展我们的合规性规则，不仅包括操作系统检查规则，还包括应用程序特定规则，例如MySQL，ngnix等。此外，我们还将添加检查程序包漏洞的功能。 不断上升的“阿尔卑斯山”图像，以及红宝石宝石和蟒蛇皮包等应用程序级软件包。

## 个人点评
提供了一个很不错的思路，通过将整个Hub上具有一定价值的image都爬取下来，然后对这些image进行了细致的不同维度的分析，清晰的展示出来目前image中存在有哪些安全漏洞值得人们去关注，每一个指标都很具有参考价值。

在文章的最后一部分，分别介绍了其他人做的一些工作，这些对我来说都具有很大的意思，可以找出还有哪些方面可以去做，要做好记录总结工作。