# 容器存储

## 镜像元数据

在 Linux 系统中 Docker 的数据默认存放在 /var/lib/docker 中，基于不同的系统又有不同的存储驱动、不同 的目录结构。镜像每一层的 ID 是该文件内容的哈希校验值，作为该层的唯一标识。获取镜像后，会使用以下方式索引镜像: 首先读取镜像的 manifests，根据 manifests 文件中 config 的 sha256 码，得到镜像 config 文件，遍历 manifests 里面的所有 layer，根据其 sha256 码在本地查找，拼出完整的镜像。

![](https://ws4.sinaimg.cn/large/006tNbRwly1fxbcysi8r7j319k0n8k47.jpg)

## 存储驱动

理想情况下，使用挂载卷来存储高读写的目录，很少将数据直接写入容器的可写层。但是，总有些特殊需求 需要直接写入容器的可写层。这时候就需要存储驱动来作为容器和宿主机之间的媒介。Docker 依靠驱动技术来 管理**镜像和运行它们的容器间**的存储和交互。目前，Docker 支持 AUFS、BtrFS、Device Mapper、OverlayFS、ZFS 五种存储驱动 [20]。没有单一的存储驱 动适合所有的应用场景，要根据不同的场景选择合适的存储驱动，才能有效提高 Docker 的性能。

![](https://ws2.sinaimg.cn/large/006tNbRwly1fxbd1675fwj319k0m6doq.jpg)

## 数据卷

有状态的容器都具有数据持久化存储的需求，因此docker采用数据卷的形式向容器提供持久化存储。绑定挂载依赖于主机的目录结构，但数据卷是由docker管理。与绑定挂载相比，数据卷有一下优点：

- 与绑定挂载相比，数据卷更容易备份或迁移
- 可以使用 Docker CLI 命令或 Docker API 管理数据卷
- 数据卷在 Linux 和 Windows 上均可使用
- 数据卷可以在多个容器之间更安全地共享
- 数据卷驱动程序允许在远程主机或云上存储数据卷、加密卷的内容或添加其它功能
- 新数据卷的内容可以由容器预填充。

与使用容器的读写层保存数据相比，数据卷是更好的选择，因为使用数据卷存储不会增加容器的大小，并且数据卷是持久化的，不会依赖于容器的生命周期。

![](https://ws3.sinaimg.cn/large/006tNbRwly1fxbd8w6zcaj319a0iuq5d.jpg)

## 微服务

微服务就是将一个完成应用中所有的模块拆分成多个不同的服务，其中每个服务都可以独立部署，维护和扩展，服务之间通常通过RESTful API进行通信。

微服务设计的本质在于功能较明确，业务较精炼的服务去解决更大更实际的问题。相比于传统的单体架构设计最大的有点在于降低了模块之间的耦合度。每个服务可以由一个团队开发和维护。不同服务可以用不同的编程语言，架构来实现。这个每个服务都可用最适合其技术加以实现。

![](https://ws3.sinaimg.cn/large/006tNbRwly1fxbfc9ow96j30zi0gw41w.jpg)