


## GitFlow
协同工作流的核心思想如下：
![](https://static001.geekbang.org/resource/image/9c/ca/9cf4c9bc17bf11aa07d47f61d2137fca.png)

整个代码库中一共有五种分支：

- Master分支：主干分支，用作发布环境，上面的每一提交都是可以发布的
- Feature分支：功能分支，用于功能开发，其对应的是开发环境
- Developer分支：开发分支，一旦功能开发完成，就向Developer分支合并，合并完成之后，删除功能分支。这个分支对应的是集成开发环境。
- Release分支：当Developer分支测试达到可发布状态时，开出一个Release分支来，然后做发布前的准备工作中，这个分支对应的是预发布环境。之所以要这个分支，是我们的开发可以继续前进，不会应为要发布而被block住而不能提交
- Hotfix分支：用于处理生产线上代码的Bug-fix，每个线上代码的Bug-fix都需要开一个Hotfix分支，完成之后，向Developer分支和Master

一旦 Release 分支上的代码达到可以上线的状态，那么需要把 Release 分支向 Master 分支和 Developer 分支同时合并，以保证代码的一致性。然后再把 Release 分支删除掉。

### GitFlow的问题
其中有个问题就是因为分支太多，所以会出现 git log 混乱的局面。具体来说，主要是 git-flow 使用git merge --no-ff来合并分支，在 git-flow 这样多个分支的环境下会让你的分支管理的 log 变得很难看。如下所示，左边是使用–no-ff 参数在多个分支下的问题。
![](https://static001.geekbang.org/resource/image/13/b8/13a78e9d493ba2737c3d6b8431be47b8.png)
所谓--no-ff参数的意思是——no fast forward的意思。也就是说，合并的方法不要把这个分支的提交以前置合并的方式，而是留下一个 merge 的提交。这是把双刃剑，我们希望我们的--no-ff能像右边那样，而不是像左边那样。

对此的建议是：只有 feature 合并到 developer 分支时，使用–no-ff 参数，其他的合并都不使用--no-ff参数来做合并。

还要一个问题就是，在开发的足够快的情况下，同时维护Master和Developer二个分支没有太大的必要。

## GitHub Flow
>[参考链接](http://scottchacon.com/2011/08/31/github-flow.html)


所谓 GitHub Flow，其实也叫 Forking flow，也就是 GitHub 上的那个开发方式。

1. 每个开发人员都把“官方库”的代码 fork 到自己的代码仓库中。
2. 然后，开发人员在自己的代码仓库中做开发，想干啥干啥。
3. 因此，开发人员的代码库中，需要配两个远程仓库，一个是自己的库，一个是官方库（用户的库用于提交代码改动，官方库用于同步代码）。
4. 然后在本地建“功能分支”，在这个分支上做代码开发。
5. 这个功能分支被 push 到开发人员自己的代码仓库中。
6. 然后，向“官方库”发起 pull request，并做 Code Review。
7. 一旦通过，就向官方库进行合并。

这就是 GitHub 的工作流程。


### 问题
GitHub Flow 这种玩法依然会有好多问题，因为其虽然变得很简单，但是没有把我们的代码和我们的运行环境给联系在一起
## GitLab Flow
其中一个是引入环境分支，如下图所示，其包含了预发布（Pre-Production）和生产（Production）分支
![](https://static001.geekbang.org/resource/image/c9/84/c9cf817612cc9d474cd253d26344e184.png)

而有些时候，我们还会有不同版本的发布，所以，还需要有各种 release 的分支。如下图所示。Master 分支是一个 roadmap 分支，然后，一旦稳定了就建稳定版的分支，如 2.3.stable 分支和 2.4.stable 分支，其中可以 cherry-pick master 分支上的一些改动过去。
![](https://static001.geekbang.org/resource/image/ed/96/ed94b250461ca2bf6d7faa2d0aaa1a96.png)

解决了二个问题：

- 环境和代码分支对应的问题
- 版本和代码分支对应的问题

## 协同工作的本质

不应该存在一种一招吃遍天的放之四海皆准的银弹方案。需要根据自己的实际情况挑选适合我们的协同工作方式。根据这么多年来我在各个公司的经历，有互联网的，有金融的，有项目的，有快速迭代的等，我认为团队协同工作的本质不外乎这么几个事儿。

1. 不同的团队能够尽可能地并行开发
2. 不同软件版本和代码的一致性。
3. 不同环境和代码的一致性。
4. 代码总是会在稳定和不稳定间交替。我们希望生产线上的代码总是能对应到稳定的代码上来。
基本上述的四个事儿，上述的工作流大都是在以建立不同的分支，来做到开发并行、代码和环境版本一致，以及稳定的代码。

### 软件开发的趋势

- 以微服务或是SOA为架构的方式：一个大型软件会被拆分成若干个服务，那么，我们的代码应该也会跟着服务拆解成若干个代码仓库。这样一来，我们的每个代码仓库都会变小，于是我们的协同工作流程就会变简单。
- 以DevOps为主的开发流程：DevOps 关注于 CI/CD，需要我们有自动化的集成测试和持续部署的工具。这样一来，我们的代码发布速度就会大大加快，每一次提交都能很快地被完整地集成测试，并很快地发布到生产线上。