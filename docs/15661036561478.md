# Volume

## 1. 为什么要引入 Volume 对象

pod 中每个容器都有自己的文件系统，在某些场景下 我们希望新容器可以在之前容器结束的位置继续运行，需要保存实际的数据的目录。

然而 Kuberentes 中的每一个容器随时都可能因为某些原因而被删除和重启，容器中的文件也会随着它的删除而丢失，所以我们需要对集群中的某些文件和数据进行『持久化』；除此之外，由于同一个 Pod 中的多个 Container 可能也会有共享文件的需求，比如通过共享文件目录的方式为 nginx 生成需要代理的静态文件，所以我们需要一种方式来解决这两个问题。

作为 Kubernetes 集群中除了 Pod 和 Service 之外最常见的基本对象，Volume 不仅能够解决 Container 中文件的临时性问题，也能够让同一个 Pod 中的多个 Container 共享文件。

Volume 的主要作用还是用于跨节点或者容器对数据进行同步和共享。
## 2. 解决了什么问题
kubernetes 通过定义**存储卷**，是 pod 的一部分，并且和 pod 共享生命周期。
## 3. 类型

EmptyDir、HostPath、ConfigMap 和 Secret，

### pv 持久卷
临时的卷没有办法解决数据持久存储的问题，想要让数据能够持久化，首先就需要将 **Pod 和卷的声明周期分离**，它与集群中的节点 Node 有些相似，PV 为 Kubernete 集群提供了一个如何提供并且使用存储的抽象，与它一起被引入的另一个对象就是 PersistentVolumeClaim(PVC)，这两个对象之间的关系与节点和 Pod 之间的关系差不多：
![](https://img.draveness.me/2019-01-14-kubernetes-pv-and-pvc.png)
可以通过StorageClass给 pv 提供不同内容的存储资源
 

### 回收策略
当某个服务使用完某一个卷之后，它们会从 apiserver 中删除 PVC 对象，这时 Kubernetes 就需要对卷进行回收（Reclaim），持久卷也同样包含三种不同的回收策略，这三种回收策略会指导 Kubernetes 选择不同的方式对使用过的卷进行处理。
 
 - 第一种回收策略就是保留（Retain）PV 中的数据，如果希望 PV 能够被重新使用，系统管理员需要删除被使用的 PersistentVolume 对象并手动清除存储和相关存储上的数据。
 - 另一种常见的回收策略就是删除（Delete），当 PVC 被使用者删除之后，如果当前卷支持删除的回收策略，那么 PV 和相关的存储会被自动删除，如果当前 PV 上的数据确实不再需要，那么将回收策略设置成 Delete 能够节省手动处理的时间并快速释放无用的资源。
## 3. 实现原理

暂不关注

