# 浅谈容器网络
Linux 容器能看见的“网络栈”，实际上是被隔离在它自己的 Network Namespace 当中的。

而所谓“网络栈”，就包括了：**网卡**（Network Interface）、**回环设备**（Loopback Device）、**路由表**（Routing Table）和 **iptables** 规则。对于一个进程来说，这些要素，其实就构成了它**发起和响应网络请求的基本环境**。

## Bridge

docker 项目在宿主机上创建一个名为 docker0 的网桥，凡是连接到 docker0网桥上的容器，就可以通过它来进行通信。


我们需要使用一种名为` Veth Pair`的虚拟设备，来把容器连接到docker0 网桥上。

Veth Pair 设备的特点是：**它被创建出来后，总是以两张虚拟网卡（Veth Peer）的形式成对出现的。并且，从其中一个“网卡”发出的数据包，可以直接出现在与它对应的另一张“网卡”上，哪怕这两个“网卡”在不同的 Network Namespace 里。**

可以理解为，在默认情况下，被现在 Network Namespace 里的容器进程，实际上是通过 Veth Pair 设备+ 宿主机网桥的方式，实现了跟同其他容器的数据交换。

## 容器的跨主通信

在 Docker 的默认配置下，一台宿主机上的 docker0 网桥，和其他宿主机上的 docker0 网桥，没有任何关联，它们互相之间也没办法连通。所以，连接在这些网桥上的容器，自然也没办法进行通信了

但是万变不离其宗，如果**我们通过软件的方式，创建了一个整个集群公用的网桥，然后把集群的所有容器都连接到这个网桥上，就可以实现了相互通信**
![](https://static001.geekbang.org/resource/image/b4/3d/b4387a992352109398a66d1dbe6e413d.png)

可以看到，构建这种容器网络的核心在于：我们需要在已有的宿主机网络上，再通过**软件构建一个覆盖在已有宿主机网络之上的、可以把所有容器连通在一起的虚拟网络**。所以，这种技术就被称为：`Overlay Network`（覆盖网络）。